<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <!-- <link rel="shortcut icon" href="./images/logo.png"> -->
    <link rel="stylesheet" href="style.css">

    <style>
        header{position: relative;}
        .change-password-container{
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            min-height: 90vh;
            padding: 1rem;
        }
        .change-password-container form{
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-radius: var(--border-radius-2);
            padding : 2.2rem 1.2rem;
            background-color: var(--color-white);
            box-shadow: var(--box-shadow);
            width: 100%;
            max-width: 28rem;
        }
        .change-password-container form:hover{box-shadow: none;}
        .change-password-container form input[type=password],
        .change-password-container form input[type=text]{
            border: none;
            outline: none;
            border: 1px solid var(--color-light);
            background: transparent;
            height: 3rem;
            width: 100%;
            border-radius: 50px;
            padding: 0 1rem;
        }
        .change-password-container form .box{
            padding: .5rem 0;
        }
        .change-password-container form .box p{
            line-height: 2;
        }
        .change-password-container form h2+p{margin: .4rem 0 1.2rem 0;} 
        .btn{
            background: none;
            border: none;
            border: 2px solid var(--color-primary) !important;
            border-radius: var(--border-radius-1);
            padding: .5rem 1rem;
            color: var(--color-white);
            background-color: var(--color-primary);
            cursor: pointer;
            margin: 1rem 1.5rem 1rem 0;
            margin-top: 1.5rem;
            min-width: 100px;
        }
        .btn[disabled] {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .btn:hover:enabled{
            color: var(--color-primary);
            background-color: transparent;
        }
        .strength-meter {
            height: 6px;
            border-radius: 3px;
            margin: 0.3rem 0 0.7rem 0;
            background: #eee;
            overflow: hidden;
        }
        .strength-meter-bar {
            height: 100%;
            transition: width 0.3s;
        }
        .strength-weak { background: #e74c3c; }
        .strength-medium { background: #f1c40f; }
        .strength-strong { background: #27ae60; }
        #message-area {
            min-height:1.5em;
            margin-bottom:.5em;
            display: flex;
            align-items: center;
            gap: 0.5em;
            font-size: 1em;
        }
        #message-area .material-icons-sharp {
            font-size: 1.2em;
        }
        @media (max-width: 600px) {
            .change-password-container form {
                padding: 1rem 0.3rem;
                max-width: 100vw;
            }
        }
    </style>

</head>
<body>
    <header>
        <div class="logo">
            <h2>E<span class="danger">Y</span>U</h2>
        </div>
        <div class="navbar">
            <a href="index.html">
                <span class="material-icons-sharp">home</span>
                <h3>Home</h3>
            </a>
            <a href="timetable.html" onclick="timeTableAll()">
                <span class="material-icons-sharp">today</span>
                <h3>Time Table</h3>
            </a> 
            <a href="exam.html">
                <span class="material-icons-sharp">grid_view</span>
                <h3>Examination</h3>
            </a>
            <a href="password.html" class="active">
                <span class="material-icons-sharp">password</span>
                <h3>Change Password</h3>
            </a>
            <a href="#">
                <span class="material-icons-sharp">logout</span>
                <h3>Logout</h3>
            </a>
        </div>
        <div id="profile-btn" style="display: none;">
            <span class="material-icons-sharp">person</span>
        </div>
        <div class="theme-toggler">
            <span class="material-icons-sharp active">light_mode</span>
            <span class="material-icons-sharp">dark_mode</span>
        </div>
    </header>

    <div class="change-password-container">
        <form action="">
            <h2>Create new password</h2>
            <p class="text-muted">Your new password must be different from previous used passwords.</p>
            <div class="box">
                <label for="currentpass" class="text-muted">Current Password</label>
                <div style="position:relative;">
                    <input type="password" id="currentpass" aria-label="Current Password" autocomplete="current-password">
                    <span class="toggle-pass" onclick="togglePassword('currentpass', this)" title="Show/Hide Password" style="position:absolute;right:10px;top:7px;cursor:pointer;">
                        <span class="material-icons-sharp">visibility_off</span>
                    </span>
                </div>
            </div>
            <div class="box">
                <label for="newpass" class="text-muted">New Password</label>
                <div style="position:relative;">
                    <input type="password" id="newpass" aria-label="New Password" autocomplete="new-password" oninput="updateStrengthMeter()">
                    <span class="toggle-pass" onclick="togglePassword('newpass', this)" title="Show/Hide Password" style="position:absolute;right:10px;top:7px;cursor:pointer;">
                        <span class="material-icons-sharp">visibility_off</span>
                    </span>
                </div>
                <div class="strength-meter" aria-hidden="true">
                    <div id="strength-bar" class="strength-meter-bar strength-weak" style="width:0%"></div>
                </div>
                <div id="strength-text" style="font-size:0.9em;color:#888;min-height:1.2em;"></div>
            </div>
            <div class="box">
                <label for="confirmpass" class="text-muted">Confirm Password</label>
                <div style="position:relative;">
                    <input type="password" id="confirmpass" aria-label="Confirm Password" autocomplete="new-password">
                    <span class="toggle-pass" onclick="togglePassword('confirmpass', this)" title="Show/Hide Password" style="position:absolute;right:10px;top:7px;cursor:pointer;">
                        <span class="material-icons-sharp">visibility_off</span>
                    </span>
                </div>
            </div>
            <div id="message-area" aria-live="polite"></div>
            <div class="button">
                <input type="submit" value="Save" class="btn">
                <a href="index.html" class="text-muted">Cancel</a>
            </div>
            <a href="#" style="display:block;text-align:right;font-weight:bold;color:var(--color-primary);margin-top:.5em;">Forgot password?</a>
    </form>    
    </div>

</body>

<script src="app.js"></script>
<script>
// Toggle password visibility
function togglePassword(id, el) {
    const input = document.getElementById(id);
    const icon = el.querySelector('.material-icons-sharp');
    if (input.type === 'password') {
        input.type = 'text';
        icon.textContent = 'visibility';
    } else {
        input.type = 'password';
        icon.textContent = 'visibility_off';
    }
}

// Password strength meter
function updateStrengthMeter() {
    const val = document.getElementById('newpass').value;
    const bar = document.getElementById('strength-bar');
    const text = document.getElementById('strength-text');
    let score = 0;
    if (val.length >= 6) score++;
    if (/[A-Z]/.test(val)) score++;
    if (/[0-9]/.test(val)) score++;
    if (/[^A-Za-z0-9]/.test(val)) score++;
    let width = '0%';
    let label = '';
    let cls = 'strength-weak';
    if (val.length === 0) {
        width = '0%';
        label = '';
    } else if (score <= 1) {
        width = '33%';
        label = 'Weak';
        cls = 'strength-weak';
    } else if (score === 2 || score === 3) {
        width = '66%';
        label = 'Medium';
        cls = 'strength-medium';
    } else if (score === 4) {
        width = '100%';
        label = 'Strong';
        cls = 'strength-strong';
    }
    bar.style.width = width;
    bar.className = 'strength-meter-bar ' + cls;
    text.textContent = label;
}

// Client-side validation with feedback
document.querySelector('.change-password-container form').addEventListener('submit', function(e) {
    e.preventDefault();
    const current = document.getElementById('currentpass').value.trim();
    const npass = document.getElementById('newpass').value.trim();
    const cpass = document.getElementById('confirmpass').value.trim();
    const msg = document.getElementById('message-area');
    msg.innerHTML = '';
    let error = '';
    if (!current || !npass || !cpass) {
        error = '<span class="material-icons-sharp" style="color:#e74c3c;">error</span> All fields are required.';
    } else if (npass.length < 6) {
        error = '<span class="material-icons-sharp" style="color:#e74c3c;">error</span> New password must be at least 6 characters.';
    } else if (npass !== cpass) {
        error = '<span class="material-icons-sharp" style="color:#e74c3c;">error</span> New password and confirmation do not match.';
    }
    if (error) {
        msg.innerHTML = error;
        return;
    }
    // Show loading spinner
    msg.innerHTML = '<span class="material-icons-sharp" style="color:#3498db;animation:spin 1s linear infinite;">autorenew</span> Saving...';
    document.querySelector('.btn').disabled = true;
    setTimeout(() => {
        msg.innerHTML = '<span class="material-icons-sharp" style="color:#27ae60;">check_circle</span> Password updated successfully!';
        document.querySelector('.btn').disabled = false;
        // Optionally redirect after success
        // setTimeout(() => { window.location.href = 'index.html'; }, 1200);
    }, 1200);
});

// Spinner animation
const style = document.createElement('style');
style.innerHTML = `@keyframes spin { 100% { transform: rotate(360deg); } }`;
document.head.appendChild(style);
</script>

</html>